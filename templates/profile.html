<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Monitoring System - User Profile</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      /* Light theme */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-color: #e2e8f0;
      --accent-primary: #3b82f6;
      --accent-secondary: #1d4ed8;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: rgba(0, 0, 0, 0.1);
      --shadow-lg: rgba(0, 0, 0, 0.15);
    }

    [data-theme="dark"] {
      /* Dark theme */
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --border-color: #475569;
      --accent-primary: #60a5fa;
      --accent-secondary: #3b82f6;
      --success: #34d399;
      --warning: #fbbf24;
      --danger: #f87171;
      --shadow: rgba(0, 0, 0, 0.3);
      --shadow-lg: rgba(0, 0, 0, 0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      transition: all 0.3s ease;
      min-height: 100vh;
    }

    /* Navigation */
    .navbar {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 0 2rem;
      box-shadow: 0 1px 3px var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
      height: 70px;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-primary);
    }

    .nav-brand i {
      font-size: 2rem;
    }

    .nav-role {
      background: var(--accent-primary);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .nav-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }

    .nav-btn:hover {
      background: var(--accent-primary);
      color: white;
      transform: translateY(-1px);
    }

    .nav-btn.primary {
      background: var(--accent-primary);
      color: white;
    }

    .nav-btn.primary:hover {
      background: var(--accent-secondary);
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .theme-toggle:hover {
      color: var(--accent-primary);
      background: var(--bg-tertiary);
    }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Page Header */
    .page-header {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 4px var(--shadow);
    }

    .page-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .page-subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
      font-weight: 400;
    }

    /* Profile Content */
    .profile-content {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 2rem;
      align-items: start;
    }

    /* Profile Card */
    .profile-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 2px 4px var(--shadow);
      text-align: center;
      position: sticky;
      top: 90px;
    }

    .profile-avatar {
      position: relative;
      width: 150px;
      height: 150px;
      margin: 0 auto 1.5rem;
      border-radius: 50%;
      overflow: hidden;
      border: 4px solid var(--accent-primary);
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-avatar .default-avatar {
      font-size: 4rem;
      color: var(--text-muted);
    }

    .avatar-upload {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: var(--accent-primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px var(--shadow);
    }

    .avatar-upload:hover {
      background: var(--accent-secondary);
      transform: scale(1.1);
    }

    .profile-name {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .profile-email {
      color: var(--text-secondary);
      font-size: 1rem;
      margin-bottom: 1rem;
      font-family: 'Monaco', 'Menlo', monospace;
    }

    .profile-role {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 1.5rem;
    }

    .role-admin {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .role-midadmin {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .role-superadmin {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .profile-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border-color);
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-primary);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Profile Details */
    .profile-details {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 2px 4px var(--shadow);
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--border-color);
    }

    /* Form Styling */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
      font-weight: 500;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-control:disabled {
      background: var(--bg-tertiary);
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-help {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
      font-style: italic;
    }

    /* Button Styling */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 500;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--accent-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-secondary);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
      transform: translateY(-1px);
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    /* Alert Messages */
    .alert {
      padding: 1rem 1.25rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideIn 0.3s ease;
    }

    .alert-error {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .alert-info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--accent-primary);
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loading State */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading .btn {
      position: relative;
    }

    .loading .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 16px;
      height: 16px;
      margin: -8px 0 0 -8px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Hidden file input */
    .file-input {
      display: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .profile-content {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .profile-card {
        position: static;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .btn-group {
        flex-direction: column;
      }

      .profile-stats {
        flex-direction: column;
        gap: 1rem;
      }
    }

    /* Animation for new elements */
    .fade-in {
      animation: fadeInUp 0.5s ease;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <i class="fas fa-envelope-open-text"></i>
        <span>EmailMonitor</span>
        <span class="nav-role">{{ user.role|title }}</span>
      </div>
      
      <div class="nav-actions">
        <a href="{{ url_for('dashboard') }}" class="nav-btn">
          <i class="fas fa-tachometer-alt"></i>
          Dashboard
        </a>
        
        {% if user.role == 'superadmin' %}
        <a href="{{ url_for('manage_users') }}" class="nav-btn">
          <i class="fas fa-users-cog"></i>
          Manage Users
        </a>
        {% endif %}
        
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
          <i class="fas fa-moon"></i>
        </button>
        
        <a href="{{ url_for('logout') }}" class="nav-btn">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </a>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">
        <i class="fas fa-user-circle"></i>
        User Profile
      </h1>
      <p class="page-subtitle">Manage your personal information and account settings</p>
    </div>

    <!-- Profile Content -->
    <div class="profile-content">
      <!-- Profile Card -->
      <div class="profile-card fade-in">
        <div class="profile-avatar">
          {% if profile and profile.profile_pic %}
            <img src="data:image/jpeg;base64,{{ profile.profile_pic }}" alt="Profile Picture" id="profile-image">
          {% else %}
            <i class="fas fa-user-circle default-avatar"></i>
          {% endif %}
          <button class="avatar-upload" onclick="document.getElementById('profile-pic-input').click()">
            <i class="fas fa-camera"></i>
          </button>
        </div>
        
        <div class="profile-name">
          {{ profile.name if profile and profile.name else user.username.split('@')[0]|title }}
        </div>
        <div class="profile-email">{{ user.username }}</div>
        
        <div class="profile-role role-{{ user.role }}">
          {% if user.role == 'superadmin' %}
            <i class="fas fa-crown"></i>
            Super Administrator
          {% elif user.role == 'midadmin' %}
            <i class="fas fa-user-tie"></i>
            Mid Administrator
          {% else %}
            <i class="fas fa-user-check"></i>
            Administrator
          {% endif %}
        </div>

        <div class="profile-stats">
          <div class="stat-item">
            <div class="stat-value">{{ join_days }}</div>
            <div class="stat-label">Days Active</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ email_count }}</div>
            <div class="stat-label">Emails Handled</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ reply_count }}</div>
            <div class="stat-label">Replies Sent</div>
          </div>
        </div>
      </div>

      <!-- Profile Details -->
      <div class="profile-details fade-in">
        <h2 class="section-title">
          <i class="fas fa-edit"></i>
          Profile Information
        </h2>

        {% if error %}
          <div class="alert alert-error">
            <i class="fas fa-exclamation-circle"></i>
            {{ error }}
          </div>
        {% endif %}

        {% if success %}
          <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            {{ success }}
          </div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" id="profile-form">
          <input type="hidden" name="action" value="update_profile">
          <input type="file" id="profile-pic-input" name="profile_pic" class="file-input" accept="image/*" onchange="previewImage(this)">
          
          <div class="form-group">
            <label for="name" class="form-label">
              <i class="fas fa-user"></i>
              Full Name
            </label>
            <input type="text" id="name" name="name" class="form-control" 
                   value="{{ profile.name if profile and profile.name else '' }}" 
                   placeholder="Enter your full name" required>
          </div>

          <div class="form-group">
            <label for="email" class="form-label">
              <i class="fas fa-envelope"></i>
              Email Address
            </label>
            <input type="email" id="email" name="email" class="form-control" 
                   value="{{ user.username }}" disabled>
            <div class="form-help">
              Email cannot be changed. Contact administrator for email updates.
            </div>
          </div>

          <div class="form-group">
            <label for="pincode" class="form-label">
              <i class="fas fa-map-pin"></i>
              PIN Code
            </label>
            <input type="text" id="pincode" name="pincode" class="form-control" 
                   value="{{ profile.pincode if profile and profile.pincode else '' }}" 
                   placeholder="Enter 6-digit PIN code" maxlength="6" pattern="[0-9]{6}" 
                   onchange="fetchAddressDetails(this.value)">
            <div class="form-help">
              Address details will be automatically filled based on PIN code
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="city" class="form-label">
                <i class="fas fa-city"></i>
                City
              </label>
              <input type="text" id="city" name="city" class="form-control" 
                     value="{{ profile.city if profile and profile.city else '' }}" readonly>
            </div>

            <div class="form-group">
              <label for="state" class="form-label">
                <i class="fas fa-map"></i>
                State
              </label>
              <input type="text" id="state" name="state" class="form-control" 
                     value="{{ profile.state if profile and profile.state else '' }}" readonly>
            </div>
          </div>

          <div class="form-group">
            <label for="district" class="form-label">
              <i class="fas fa-location-dot"></i>
              District
            </label>
            <input type="text" id="district" name="district" class="form-control" 
                   value="{{ profile.district if profile and profile.district else '' }}" readonly>
          </div>

          <div class="form-group">
            <label for="address" class="form-label">
              <i class="fas fa-home"></i>
              Complete Address
            </label>
            <textarea id="address" name="address" class="form-control" rows="3" 
                      placeholder="Enter your complete address">{{ profile.address if profile and profile.address else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="phone" class="form-label">
              <i class="fas fa-phone"></i>
              Phone Number
            </label>
            <input type="tel" id="phone" name="phone" class="form-control" 
                   value="{{ profile.phone if profile and profile.phone else '' }}" 
                   placeholder="Enter your phone number" pattern="[0-9]{10}">
          </div>

          <div class="form-group">
            <label for="join_date" class="form-label">
              <i class="fas fa-calendar"></i>
              Date of Joining
            </label>
            <input type="date" id="join_date" name="join_date" class="form-control" 
                   value="{{ profile.join_date if profile and profile.join_date else '' }}">
          </div>

          <div class="btn-group">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              Update Profile
            </button>
            <button type="button" class="btn btn-secondary" onclick="resetForm()">
              <i class="fas fa-undo"></i>
              Reset Changes
            </button>
          </div>
        </form>

        <!-- Change Password Section -->
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
          <h3 class="section-title">
            <i class="fas fa-lock"></i>
            Change Password
          </h3>

          <form method="POST" id="password-form">
            <input type="hidden" name="action" value="change_password">
            
            <div class="form-group">
              <label for="current_password" class="form-label">
                <i class="fas fa-key"></i>
                Current Password
              </label>
              <input type="password" id="current_password" name="current_password" class="form-control" 
                     placeholder="Enter current password" required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="new_password" class="form-label">
                  <i class="fas fa-lock"></i>
                  New Password
                </label>
                <input type="password" id="new_password" name="new_password" class="form-control" 
                       placeholder="Enter new password" required minlength="8">
              </div>

              <div class="form-group">
                <label for="confirm_password" class="form-label">
                  <i class="fas fa-lock"></i>
                  Confirm Password
                </label>
                <input type="password" id="confirm_password" name="confirm_password" class="form-control" 
                       placeholder="Confirm new password" required>
              </div>
            </div>

            <button type="submit" class="btn btn-warning">
              <i class="fas fa-key"></i>
              Change Password
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Theme Management
    function toggleTheme() {
      const body = document.body;
      const themeIcon = document.querySelector('.theme-toggle i');
      
      if (body.getAttribute('data-theme') === 'dark') {
        body.removeAttribute('data-theme');
        themeIcon.className = 'fas fa-moon';
        localStorage.setItem('theme', 'light');
      } else {
        body.setAttribute('data-theme', 'dark');
        themeIcon.className = 'fas fa-sun';
        localStorage.setItem('theme', 'dark');
      }
    }

    // Initialize theme from localStorage
    function initTheme() {
      const savedTheme = localStorage.getItem('theme');
      const themeIcon = document.querySelector('.theme-toggle i');
      
      if (savedTheme === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
        themeIcon.className = 'fas fa-sun';
      } else {
        themeIcon.className = 'fas fa-moon';
      }
    }

    // Profile Picture Preview
    function previewImage(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const profileImage = document.getElementById('profile-image');
          const defaultAvatar = document.querySelector('.default-avatar');
          
          if (profileImage) {
            profileImage.src = e.target.result;
          } else {
            // Create new image element if default avatar is showing
            const img = document.createElement('img');
            img.src = e.target.result;
            img.alt = 'Profile Picture';
            img.id = 'profile-image';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            
            if (defaultAvatar) {
              defaultAvatar.style.display = 'none';
            }
            
            document.querySelector('.profile-avatar').appendChild(img);
          }
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    // Fetch Address Details from PIN Code
    async function fetchAddressDetails(pincode) {
      if (pincode.length !== 6) return;
      
      try {
        const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
        const data = await response.json();
        
        if (data[0].Status === 'Success' && data[0].PostOffice.length > 0) {
          const postOffice = data[0].PostOffice[0];
          
          document.getElementById('city').value = postOffice.Name;
          document.getElementById('state').value = postOffice.State;
          document.getElementById('district').value = postOffice.District;
          
          // Show success message
          showAlert('Address details fetched successfully!', 'success');
        } else {
          showAlert('Invalid PIN code. Please check and try again.', 'error');
          clearAddressFields();
        }
      } catch (error) {
        console.error('Error fetching address:', error);
        showAlert('Failed to fetch address details. Please enter manually.', 'error');
        clearAddressFields();
      }
    }

    function clearAddressFields() {
      document.getElementById('city').value = '';
      document.getElementById('state').value = '';
      document.getElementById('district').value = '';
    }

    // Form Reset
    function resetForm() {
      document.getElementById('profile-form').reset();
      location.reload(); // Reload to get original values
    }

    // Show Alert Messages
    function showAlert(message, type) {
      const existingAlert = document.querySelector('.alert');
      if (existingAlert) {
        existingAlert.remove();
      }

      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
        ${message}
      `;

      const form = document.getElementById('profile-form');
      form.parentNode.insertBefore(alert, form);

      // Auto remove after 5 seconds
      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    // Form Validation
    function validatePasswordForm() {
      const newPassword = document.getElementById('new_password').value;
      const confirmPassword = document.getElementById('confirm_password').value;

      if (newPassword !== confirmPassword) {
        showAlert('New password and confirm password do not match!', 'error');
        return false;
      }

      if (newPassword.length < 8) {
        showAlert('Password must be at least 8 characters long!', 'error');
        return false;
      }

      return true;
    }

    // Form Submissions with Loading States
    document.getElementById('profile-form').addEventListener('submit', function(e) {
      const submitBtn = this.querySelector('button[type="submit"]');
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;
    });

    document.getElementById('password-form').addEventListener('submit', function(e) {
      if (!validatePasswordForm()) {
        e.preventDefault();
        return;
      }
      
      const submitBtn = this.querySelector('button[type="submit"]');
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;
    });

    // Phone number formatting
    document.getElementById('phone').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 10) {
        value = value.substring(0, 10);
      }
      e.target.value = value;
    });

    // PIN code formatting
    document.getElementById('pincode').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 6) {
        value = value.substring(0, 6);
      }
      e.target.value = value;
    });

    // Initialize theme on page load
    document.addEventListener('DOMContentLoaded', function() {
      initTheme();
    });

    // Auto-hide alerts
    document.addEventListener('DOMContentLoaded', function() {
      const alerts = document.querySelectorAll('.alert');
      alerts.forEach(alert => {
        setTimeout(() => {
          alert.style.opacity = '0';
          alert.style.transform = 'translateY(-10px)';
          setTimeout(() => alert.remove(), 300);
        }, 5000);
      });
    });
  </script>
</body>
</html>
